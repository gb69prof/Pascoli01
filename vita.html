<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pascoli ‚Äî La vita</title>
  <meta name="description" content="Pascoli ‚Äî La vita: cronologia essenziale con approfondimenti su immagine del mondo e poesie collegate." />

  <style>
    :root{
      /* Palette viva (fanciullino): carta + cielo + giallo caldo (coerente con index) */
      --bg1:#fbf7ef;
      --bg2:#e9f6ff;
      --ink:#1f2a33;
      --muted:rgba(31,42,51,0.72);
      --quiet:rgba(31,42,51,0.56);
      --line:rgba(31,42,51,0.14);
      --card:rgba(255,255,255,0.72);
      --card2:rgba(255,255,255,0.90);
      --accent:#ffb703;
      --accent2:#219ebc;
      --shadow:0 18px 60px rgba(0,0,0,0.14);
      --r-xl:22px;
      --r-lg:16px;
      --max:1120px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(33,158,188,0.18), transparent 62%),
        radial-gradient(820px 520px at 80% 18%, rgba(255,183,3,0.20), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      letter-spacing: .2px;
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width: var(--max); margin: 0 auto; padding: 22px 18px 28px; }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .crumbs{
      display:flex; align-items:center; gap:10px;
      font-weight: 900;
      letter-spacing:.3px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(31,42,51,0.14);
      background: rgba(255,255,255,0.88);
      font-size: 12px;
      font-weight: 950;
      user-select:none;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(33,158,188,0.45); background: rgba(255,255,255,0.96); }

    .hero{
      border: 1px solid rgba(31,42,51,0.14);
      background: rgba(255,255,255,0.78);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding: 14px 14px 12px;
      margin-bottom: 14px;
      position:relative;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(420px 220px at 18% 30%, rgba(255,183,3,0.18), transparent 60%),
        radial-gradient(420px 220px at 82% 20%, rgba(33,158,188,0.18), transparent 60%);
      pointer-events:none;
    }
    .heroInner{ position:relative; }
    .kicker{
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: rgba(31,42,51,0.72);
      font-weight: 900;
    }
    h1{
      margin: 6px 0 6px;
      font-size: clamp(26px, 4.2vw, 44px);
      line-height: 1.08;
      letter-spacing: .2px;
    }
    .subtitle{
      margin: 0;
      color: rgba(31,42,51,0.80);
      line-height: 1.55;
      font-size: 13px;
      max-width: 980px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 390px;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Card base */
    .card{
      border: 1px solid rgba(31,42,51,0.14);
      background: var(--card);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .card .hd{
      padding: 12px 14px 10px;
      border-bottom: 1px solid rgba(31,42,51,0.10);
      background: linear-gradient(180deg, rgba(255,255,255,0.70), rgba(255,255,255,0.25));
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .card .hd strong{
      font-size: 12px;
      letter-spacing: .9px;
      text-transform: uppercase;
      color: rgba(31,42,51,0.76);
    }
    .card .bd{ padding: 14px; }

    /* Testo a sinistra */
    .prose p{
      margin: 0 0 10px;
      line-height: 1.7;
      font-size: 14px;
      color: rgba(31,42,51,0.86);
    }
    .prose p:last-child{ margin-bottom:0; }

    .noteBox{
      margin-top: 12px;
      border: 1px dashed rgba(31,42,51,0.22);
      background: rgba(255,255,255,0.72);
      border-radius: 16px;
      padding: 10px 12px;
    }
    .noteBox .t{
      font-weight: 950; font-size: 12px; letter-spacing: .7px; text-transform: uppercase;
      color: rgba(31,42,51,0.70);
      margin-bottom: 6px;
    }
    .noteBox .b{
      font-size: 13px; line-height:1.55; color: rgba(31,42,51,0.84);
    }

    /* Timeline a destra */
    .timeline{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .tItem{
      width:100%;
      text-align:left;
      border: 1px solid rgba(31,42,51,0.12);
      background: rgba(255,255,255,0.82);
      border-radius: 16px;
      padding: 10px 10px;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      position:relative;
      overflow:hidden;
    }
    .tItem:hover{
      transform: translateY(-1px);
      border-color: rgba(255,183,3,0.45);
      background: rgba(255,255,255,0.94);
    }

    .tRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .tDate{
      font-weight: 950;
      font-size: 12px;
      letter-spacing:.6px;
      color: rgba(31,42,51,0.72);
      white-space:nowrap;
    }
    .tTitle{
      font-weight: 950;
      font-size: 13px;
      color: rgba(31,42,51,0.90);
      margin: 0 0 3px;
    }
    .tMini{
      font-size: 12px;
      color: rgba(31,42,51,0.70);
      line-height: 1.45;
    }
    .tChevron{
      color: rgba(33,158,188,0.95);
      font-weight: 950;
      margin-left: 8px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      font-size: 11px;
      font-weight: 950;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(31,42,51,0.14);
      background: rgba(255,255,255,0.75);
      color: rgba(31,42,51,0.78);
    }

    footer{ margin-top: 16px; font-size: 12px; color: var(--quiet); }

    /* MODAL */
    dialog{
      border: none;
      padding: 0;
      width: min(920px, calc(100vw - 22px));
      border-radius: 18px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.24);
      background: rgba(255,255,255,0.98);
      overflow:hidden;
    }
    dialog::backdrop{
      background: rgba(10,16,22,0.45);
      backdrop-filter: blur(2px);
    }
    .modalHd{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(31,42,51,0.12);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      background:
        radial-gradient(520px 240px at 20% 30%, rgba(255,183,3,0.18), transparent 60%),
        radial-gradient(520px 240px at 80% 30%, rgba(33,158,188,0.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.80));
    }
    .modalTitle{
      margin:0;
      font-size: 16px;
      font-weight: 950;
      color: rgba(31,42,51,0.92);
      line-height: 1.25;
    }
    .modalSub{
      margin: 6px 0 0;
      font-size: 12px;
      color: rgba(31,42,51,0.74);
      line-height:1.45;
      max-width: 72ch;
    }
    .closeBtn{
      appearance:none;
      border: 1px solid rgba(31,42,51,0.14);
      background: rgba(255,255,255,0.92);
      font-weight: 950;
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      user-select:none;
      white-space:nowrap;
    }
    .closeBtn:hover{ transform: translateY(-1px); border-color: rgba(33,158,188,0.45); background: rgba(255,255,255,1); }

    .modalBd{ padding: 12px 14px 14px; }

    .tabs{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .tabBtn{
      appearance:none;
      border: 1px solid rgba(31,42,51,0.14);
      background: rgba(255,255,255,0.88);
      padding: 9px 10px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 950;
      font-size: 12px;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      user-select:none;
    }
    .tabBtn:hover{ transform: translateY(-1px); border-color: rgba(255,183,3,0.45); background: rgba(255,255,255,0.96); }
    .tabBtn[aria-selected="true"]{
      border-color: rgba(33,158,188,0.45);
      outline: 2px solid rgba(33,158,188,0.25);
      outline-offset: 2px;
      background: rgba(233,246,255,0.72);
    }

    .panel{
      border: 1px solid rgba(31,42,51,0.12);
      background: rgba(255,255,255,0.82);
      border-radius: 16px;
      padding: 10px 10px;
    }
    .panel p{
      margin: 0 0 10px;
      line-height: 1.65;
      font-size: 13px;
      color: rgba(31,42,51,0.86);
    }
    .panel p:last-child{ margin-bottom:0; }

    .links{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .chipLink{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(31,42,51,0.14);
      background: rgba(255,255,255,0.88);
      font-size: 12px;
      font-weight: 950;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .chipLink:hover{
      transform: translateY(-1px);
      border-color: rgba(255,183,3,0.45);
      background: rgba(255,255,255,0.96);
    }

    @media (prefers-reduced-motion: reduce){ *{ transition:none !important; } }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="crumbs">
        <span class="badge">üü¢ OSSATURA</span>
        <span style="color:rgba(31,42,51,0.72); font-weight:900;">Pascoli</span>
        <span style="color:rgba(31,42,51,0.45);">/</span>
        <span style="font-weight:950;">La vita</span>
      </div>

      <a class="pill" href="index.html" aria-label="Torna alla home">
        ‚Ü©Ô∏é Home
      </a>
    </div>

    <section class="hero" aria-label="Introduzione">
      <div class="heroInner">
        <div class="kicker">Cronologia essenziale + approfondimenti mirati</div>
        <h1>La vita (senza museo)</h1>
        <p class="subtitle">
          Qui non trovi ‚Äútutta la biografia‚Äù: trovi i nodi che hanno costruito Pascoli.
          A destra c‚Äô√® la cronologia essenziale. Tocchi un punto e si aprono due cose:
          <b>1) come contribuisce alla sua immagine del mondo</b> e <b>2) quali poesie puoi collegare</b>.
        </p>
      </div>
    </section>

    <section class="grid" aria-label="Vita Pascoli: testo e timeline">

      <!-- SINISTRA: testo -->
      <article class="card" aria-label="Sintesi della vita">
        <div class="hd">
          <strong>Sintesi (chiara, non cupa)</strong>
          <span class="badge">üéà fanciullino ‚â† zucchero</span>
        </div>
        <div class="bd prose">
          <p>
            Giovanni Pascoli nasce a San Mauro di Romagna nel 1855. L‚Äôinfanzia viene spezzata dall‚Äôassassinio del padre Ruggero (10 agosto 1867) e,
            negli anni immediatamente successivi, da una serie di lutti familiari. Da questa frattura nasce l‚Äôidea del <b>nido</b> come bisogno vitale:
            non un tema ‚Äúcarino‚Äù, ma un modo di sopravvivere al mondo.
          </p>
          <p>
            Studia in collegio (Urbino) e poi a Bologna, allievo di Carducci. Gli anni universitari sono agitati: partecipa a movimenti e proteste,
            perde la borsa di studio e subisce anche il carcere. Pi√π tardi torna agli studi e si laurea.
          </p>
          <p>
            Inizia a insegnare e costruisce la propria vita attorno a un equilibrio fragile ma tenace: le sorelle, soprattutto Maria (‚ÄúMari√π‚Äù).
            Quando Ida si sposa, Pascoli vive la cosa come un abbandono: non √® un dettaglio sentimentale, √® struttura psicologica.
          </p>
          <p>
            Ottiene incarichi universitari importanti (Messina, poi Bologna) e nel 1903 succede a Carducci.
            Ma la vera dimora, per lui, √® Castelvecchio di Barga: campagna, natura, suoni, cose minime. Muore nel 1912 a Bologna.
          </p>

          <div class="noteBox">
            <div class="t">Come usare questa pagina</div>
            <div class="b">
              Se vuoi solo orientarti: leggi questa colonna e basta. Se vuoi capire davvero ‚Äúperch√© Pascoli √® Pascoli‚Äù:
              apri 2‚Äì3 nodi della timeline. Non serve aprirli tutti.
            </div>
          </div>

          <div style="margin-top:12px; font-size:12px; color:rgba(31,42,51,0.62); line-height:1.5;">
            Fonte sintetica: il testo biografico fornito da te 
          </div>
        </div>
      </article>

      <!-- DESTRA: timeline -->
      <aside class="card" aria-label="Cronologia essenziale">
        <div class="hd">
          <strong>Cronologia essenziale</strong>
          <span class="badge">tocca ‚Üí approfondisci</span>
        </div>
        <div class="bd">
          <div class="timeline" id="timeline"></div>

          <div style="margin-top:12px; font-size:12px; color:rgba(31,42,51,0.62); line-height:1.5;">
            Nota: i collegamenti ‚Äúpoesie‚Äù sono proposti come <b>ponte didattico</b> (puoi cambiarli quando vuoi).
          </div>
        </div>
      </aside>

    </section>

    <footer>¬© <span id="year"></span> ‚Äî Pascoli / Libro.0 ‚Äî a cura di gbprof</footer>
  </div>

  <!-- MODAL -->
  <dialog id="modal">
    <div class="modalHd">
      <div>
        <h2 class="modalTitle" id="mTitle">Titolo</h2>
        <p class="modalSub" id="mSub">Sottotitolo</p>
      </div>
      <button class="closeBtn" id="mClose" type="button" aria-label="Chiudi">‚úï Chiudi</button>
    </div>
    <div class="modalBd">
      <div class="tabs" role="tablist" aria-label="Approfondimenti">
        <button class="tabBtn" id="tabWorld" type="button" role="tab" aria-selected="true" aria-controls="panelWorld">
          1) Immagine del mondo
        </button>
        <button class="tabBtn" id="tabPoems" type="button" role="tab" aria-selected="false" aria-controls="panelPoems">
          2) Poesie collegate
        </button>
      </div>

      <div class="panel" id="panelWorld" role="tabpanel" aria-labelledby="tabWorld"></div>
      <div class="panel" id="panelPoems" role="tabpanel" aria-labelledby="tabPoems" hidden></div>
    </div>
  </dialog>

  <script>
    const $ = (q, r=document) => r.querySelector(q);

    // Year
    $('#year').textContent = new Date().getFullYear();

    // Dati timeline (nodi essenziali, presi dal tuo testo + collegamenti didattici)
    const EVENTS = [
      {
        date: "1855",
        title: "Nasce a San Mauro di Romagna",
        mini: "Origine rurale, ‚Äúcose‚Äù e natura come alfabeti.",
        sub: "31 dicembre 1855: famiglia numerosa, benessere rurale moderato.",
        world: `
          <p>
            L‚Äôinizio non √® ‚Äúbiografia‚Äù: √® <b>lessico</b>. Pascoli impara presto che le cose minime (campi, animali, suoni)
            non sono sfondo: sono <b>lingua</b>. Da qui la sua attenzione quasi microscopica al dettaglio.
          </p>
          <p>
            Il fanciullino non nasce in astratto: nasce in un mondo dove il piccolo ha gi√† valore e presenza.
          </p>
        `,
        poems: [
          { label: "Romagna (se la usi)", href: "#", note: "Se hai una pagina dedicata, metti qui il link." },
          { label: "Myricae (cornice)", href: "#", note: "Raccolta: natura, suoni, frammenti." }
        ]
      },
      {
        date: "1867",
        title: "Assassinio del padre (10 agosto)",
        mini: "La frattura: trauma e domanda senza risposta.",
        sub: "10 agosto 1867: Ruggero Pascoli ucciso in un agguato; omicidio impunito.",
        world: `
          <p>
            Qui si accende l‚Äôidea pascoliana pi√π dura: la realt√† pu√≤ essere <b>ingiusta senza spiegazione</b>.
            Non √® ‚Äúpessimismo filosofico‚Äù: √® esperienza.
          </p>
          <p>
            Da questa ferita nasce anche la scrittura come <b>registrazione di segni</b> (presagi, suoni, lampi), perch√© quando il senso manca,
            il mondo sembra parlare per indizi.
          </p>
        `,
        poems: [
          { label: "X agosto", href: "testi/x-agosto.html", note: "Collegamento diretto al 10 agosto." },
          { label: "La cavalla storna (se la tratti)", href: "#", note: "Altro nodo memoriale legato al padre." }
        ]
      },
      {
        date: "1868‚Äì1871",
        title: "Catena di lutti familiari",
        mini: "Il ‚Äúguscio‚Äù si rompe: nasce il bisogno del nido.",
        sub: "Negli anni successivi muoiono madre, sorella e fratelli (frattura del nucleo).",
        world: `
          <p>
            Il <b>nido</b> non √® un simbolo tenero: √® un dispositivo di difesa.
            Se il mondo pu√≤ colpire dentro casa, allora la casa diventa ossessione, ricostruzione, rito.
          </p>
          <p>
            Da qui anche l‚Äôinfanzia come luogo perduto: non nostalgia da cartolina, ma <b>assenza che brucia</b>.
          </p>
        `,
        poems: [
          { label: "Il nido (tema)", href: "#", note: "Se vuoi: crea una pagina-tema sul ‚Äúnido‚Äù." },
          { label: "Novembre / Temporale / L‚Äôassiuolo (se li usi)", href: "#", note: "Natura come eco emotiva, non decorazione." }
        ]
      },
      {
        date: "1873‚Äì1882",
        title: "Bologna: Carducci, politica, inquietudine",
        mini: "Studio + scosse: protesta, perdita borsa, carcere.",
        sub: "1876 perdita borsa; 1879 carcere; 1882 laurea (tesi su Alceo).",
        world: `
          <p>
            Qui entra un elemento spesso ignorato: Pascoli non √® solo ‚Äúcampagna‚Äù.
            Conosce conflitto, storia, ideologia. Ma quella energia non diventa epopea: diventa <b>tensione interna</b>.
          </p>
          <p>
            La sua modernit√† sta anche qui: un intellettuale che ha visto la frattura sociale, ma parla con voce obliqua,
            laterale, anti-retorica.
          </p>
        `,
        poems: [
          { label: "Poemi conviviali (se li accenni)", href: "#", note: "Classico e moderno: un ponte." },
          { label: "Testo su ‚Äúsegni/presagi‚Äù (pagina mondo)", href: "mondo.html", note: "Quando la farai: qui ci sta bene." }
        ]
      },
      {
        date: "1882‚Äì1895",
        title: "Insegnamento e ‚Äúricomposizione‚Äù",
        mini: "Matera, Massa, Livorno: lavoro e tentativo di equilibrio.",
        sub: "Insegnamenti nei licei; vicino alle sorelle Ida e Maria.",
        world: `
          <p>
            L‚Äôinsegnamento √® un fatto pratico, ma per Pascoli √® anche un modo per tenere in piedi una vita
            che tende a scomporsi.
          </p>
          <p>
            La ricomposizione familiare (con le sorelle) non √® contorno: √® la forma concreta del ‚Äúnido‚Äù ricostruito.
          </p>
        `,
        poems: [
          { label: "Myricae (cose minime)", href: "#", note: "Seleziona 2‚Äì3 testi brevi per mostrare il metodo." },
          { label: "Digitale purpurea", href: "testi/digitale-purpurea.html", note: "Se la usi come testo del percorso." }
        ]
      },
      {
        date: "1895",
        title: "Ida si sposa: ferita affettiva",
        mini: "Vissuto come abbandono: il nido non regge.",
        sub: "Evento privato, ma strutturante: cambia l‚Äôequilibrio familiare.",
        world: `
          <p>
            Questo nodo spiega una cosa: Pascoli ‚Äúadulto‚Äù non coincide con ‚Äústabile‚Äù.
            Alcuni passaggi normali (un matrimonio) per lui diventano <b>crollo di struttura</b>.
          </p>
          <p>
            Il fanciullino, qui, √® anche questo: una vulnerabilit√† che non si chiude.
          </p>
        `,
        poems: [
          { label: "Il gelsomino notturno", href: "testi/gelsomino-notturno.html", note: "Se lo lavori: matrimonio, intimit√†, soglia." },
          { label: "Poesie del ‚Äúnido‚Äù (tema)", href: "#", note: "Puoi creare una pagina-tema che raccoglie rimandi." }
        ]
      },
      {
        date: "1895‚Äì1912",
        title: "Castelvecchio di Barga: il rifugio",
        mini: "Campagna come casa poetica; Maria accanto.",
        sub: "Dimora prediletta: natura, quiete, lavoro poetico.",
        world: `
          <p>
            Castelvecchio non √® ‚Äúpaesaggio‚Äù: √® un <b>laboratorio sensoriale</b>.
            Suoni, insetti, vento, luci: diventano una grammatica.
          </p>
          <p>
            Qui l‚Äôimmagine del mondo si fa chiarissima: la realt√† √® fatta di <b>minimi segnali</b> che sembrano parlare
            pi√π delle grandi spiegazioni.
          </p>
        `,
        poems: [
          { label: "L‚Äôassiuolo (se lo fai)", href: "#", note: "Suono come presagio." },
          { label: "Temporale / Il lampo (se li fai)", href: "#", note: "Visione rapida, impressione, scatto." }
        ]
      },
      {
        date: "1903",
        title: "Succede a Carducci a Bologna",
        mini: "Prestigio, ma fatica: non ama la macchina accademica.",
        sub: "Cattedra di Letteratura Italiana (Bologna): incarico prestigioso.",
        world: `
          <p>
            Questo √® il paradosso pascoliano: la gloria arriva, ma non guarisce.
            La sua scrittura resta anti-trionfalistica: non √® fatta per celebrare, √® fatta per <b>registrare</b>.
          </p>
        `,
        poems: [
          { label: "Poetica del fanciullino (pagina poetica)", href: "poetica.html", note: "Quando la farai: collega qui." }
        ]
      },
      {
        date: "1912",
        title: "Muore a Bologna (6 aprile)",
        mini: "Chiude a 56 anni: vita e opera restano inseparabili.",
        sub: "6 aprile 1912: morte prematura; sepolto a Castelvecchio.",
        world: `
          <p>
            Qui puoi far passare l‚Äôidea pi√π semplice e pi√π vera:
            Pascoli non √® ‚Äúuno stile‚Äù. √à una risposta (in forma poetica) a una frattura originaria.
          </p>
        `,
        poems: [
          { label: "Ripasso: X agosto", href: "testi/x-agosto.html", note: "Il nodo sorgivo." },
          { label: "Ripasso: Digitale purpurea", href: "testi/digitale-purpurea.html", note: "L‚Äôambiguit√† dei segni." }
        ]
      }
    ];

    // Render timeline
    const tl = $('#timeline');
    EVENTS.forEach((ev, i) => {
      const btn = document.createElement('button');
      btn.type = "button";
      btn.className = "tItem";
      btn.innerHTML = `
        <div class="tRow">
          <div style="min-width:0;">
            <div class="tTitle">${escapeHTML(ev.title)}</div>
            <div class="tMini">${escapeHTML(ev.mini)}</div>
          </div>
          <div style="display:flex; align-items:flex-start;">
            <div class="tDate">${escapeHTML(ev.date)}</div>
            <div class="tChevron">‚Ä∫</div>
          </div>
        </div>
      `;
      btn.addEventListener('click', () => openModal(ev));
      tl.appendChild(btn);
    });

    // Modal logic
    const modal = $('#modal');
    const mTitle = $('#mTitle');
    const mSub = $('#mSub');
    const panelWorld = $('#panelWorld');
    const panelPoems = $('#panelPoems');

    const tabWorld = $('#tabWorld');
    const tabPoems = $('#tabPoems');

    function setTab(which){
      const isWorld = which === 'world';
      tabWorld.setAttribute('aria-selected', isWorld ? 'true' : 'false');
      tabPoems.setAttribute('aria-selected', isWorld ? 'false' : 'true');
      panelWorld.hidden = !isWorld;
      panelPoems.hidden = isWorld;
    }

    tabWorld.addEventListener('click', () => setTab('world'));
    tabPoems.addEventListener('click', () => setTab('poems'));

    $('#mClose').addEventListener('click', () => modal.close());
    modal.addEventListener('click', (e) => {
      // chiudi cliccando fuori dalla card
      const rect = modal.getBoundingClientRect();
      const inDialog =
        e.clientX >= rect.left && e.clientX <= rect.right &&
        e.clientY >= rect.top && e.clientY <= rect.bottom;
      if(!inDialog) modal.close();
    });

    function openModal(ev){
      mTitle.textContent = `${ev.date} ‚Äî ${ev.title}`;
      mSub.textContent = ev.sub || "";

      panelWorld.innerHTML = ev.world || "<p>(da completare)</p>";

      panelPoems.innerHTML = `
        <p style="margin:0 0 8px; font-weight:950;">
          Collegamenti consigliati:
        </p>
        ${renderPoems(ev.poems || [])}
        <p style="margin-top:10px; color:rgba(31,42,51,0.70);">
          Se un link √® ‚Äú#‚Äù, significa: non hai ancora la pagina. Quando la crei, sostituisci ‚Äú#‚Äù con il percorso giusto.
        </p>
      `;

      setTab('world');

      if(typeof modal.showModal === "function") modal.showModal();
      else alert("Il tuo browser non supporta i dialog. Apri con un browser moderno.");
    }

    function renderPoems(list){
      if(!list.length){
        return `<p>Nessun collegamento impostato.</p>`;
      }
      const chips = list.map(p => {
        const href = p.href || "#";
        const label = escapeHTML(p.label || "link");
        const title = escapeHTML(p.note || "");
        const safeHref = href;
        return `<a class="chipLink" href="${safeHref}" title="${title}">
                  üìé ${label}
                </a>`;
      }).join("");
      return `<div class="links">${chips}</div>`;
    }

    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  </script>
</body>
</html>
